<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Photographers Dashboard</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f8f9fa;
    }

    /* Navbar */
    .navbar {
      background: #ffffff;
      border-bottom: 1px solid #e9ecef;
    }
    .navbar-brand {
      font-weight: 600;
      color: #343a40 !important;
    }

    /* Profile */
    .profile-header {
      text-align: center;
      padding: 2rem 1rem;
    }
    .profile-pic {
      width: 110px;
      height: 110px;
      border-radius: 50%;
      object-fit: cover;
      margin-bottom: 1rem;
    }
    .profile-info h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    .profile-info p {
      font-size: 0.95rem;
      color: #6c757d;
    }
    .profile-buttons .btn {
      border-radius: 20px;
      font-size: 0.9rem;
    }

    /* Marketplace Grid */
    .marketplace {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 1rem;
    }
    .image-card img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: .5rem;
      cursor: pointer;
      transition: transform .2s;
    }
    .image-card img:hover {
      transform: scale(1.03);
    }

    /* Modal images */
    .modal-img {
      max-width: 100%;
      border-radius: .5rem;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">GalleryLoop</a>
      <div class="ms-auto d-flex gap-3">
        <button class="btn btn-sm btn-outline-secondary">Notifications</button>
        <a href="/logout" class="btn btn-sm btn-primary">Logout</a>
      </div>
    </div>
  </nav>

  <!-- Profile -->
  <div class="container">
    <div class="profile-header">
      <img src="{{ url_for('static', filename=profile.profile_img.split('static/')[-1]) }}" alt="Profile" class="profile-pic">
      <div class="profile-info">
        <h1>{{ profile.name }}</h1>
        <p>{{ profile.bio }}</p>
      </div>
      <div class="profile-buttons mt-3 d-flex flex-wrap gap-2 justify-content-center">
        <button class="btn btn-primary" onclick="openModal()">Edit Profile</button>
        <button class="btn btn-outline-primary" onclick="Post()">Post</button>
        <button class="btn btn-outline-primary" onclick="uploadmodel()">Upload</button>
        <button class="btn btn-outline-secondary" onclick="showPastEvents()">Past Events</button>
      </div>
    </div>

    <!-- Marketplace -->
    <div class="marketplace" id="marketplace"></div>
  </div>

  <!-- Image Preview Modal -->
  <div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
      <div class="modal-content p-3">
        <img src="" class="modal-img" id="modalImage" alt="Expanded Image">
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4">
        <h5>Edit Profile</h5>
        <form action="/update_profile" method="POST" enctype="multipart/form-data">
          <input type="text" name="name" placeholder="Enter Name" class="form-control mb-2">
          <input type="text" name="bio" placeholder="Enter Bio" class="form-control mb-2">
          <input type="file" name="profile_pic" class="form-control mb-3">
          <button type="submit" class="btn btn-primary w-100">Update</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Upload Modal -->
  <div class="modal fade" id="uploadModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4">
        <h5>Upload Photos</h5>
        <form id="uploadForm" action="/upload_photos" method="POST" enctype="multipart/form-data">
          <label class="form-label">Visibility</label>
          <select id="status" name="status" class="form-select mb-2" onchange="togglePrivateFields()">
            <option value="public">Public</option>
            <option value="private">Private</option>
          </select>
          <input type="number" name="cost" placeholder="Price" class="form-control mb-2">
          <div id="privateFields" style="display:none;">
            <input type="email" name="clientEmail" placeholder="Client Email" class="form-control mb-2">
            <input type="text" name="clientName" placeholder="Client Name" class="form-control mb-2">
            <input type="tel" name="clientMobile" placeholder="Client Mobile" class="form-control mb-2">
          </div>
          <input type="date" name="date" class="form-control mb-2">
          <input type="file" name="photos" multiple class="form-control mb-3">
          <button type="submit" class="btn btn-primary w-100">Upload</button>
        </form>
      </div>
    </div>
  </div>

  <!-- Past Events Modal -->
  <div class="modal fade" id="pastEventsModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content p-4">
        <h5>Past Events</h5>
        <div id="eventList"></div>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Expand image in modal
    function expandImage(url) {
      document.getElementById("modalImage").src = url;
      new bootstrap.Modal(document.getElementById("imageModal")).show();
    }

    // Toggle private fields
    function togglePrivateFields() {
      const status = document.getElementById("status").value;
      document.getElementById("privateFields").style.display = (status === "private") ? "block" : "none";
    }

    // Open modals
    function openModal() {
      new bootstrap.Modal(document.getElementById("editModal")).show();
    }
    function Post() {
      new bootstrap.Modal(document.getElementById("editPost")).show();
    }
    function uploadmodel() {
      new bootstrap.Modal(document.getElementById("uploadModal")).show();
    }
    function showPastEvents() {
      const modal = new bootstrap.Modal(document.getElementById("pastEventsModal"));
      modal.show();

      fetch('/get-past-events')
        .then(res => res.json())
        .then(data => {
          const eventList = document.getElementById('eventList');
          eventList.innerHTML = "";

          if (data.clients?.length) {
            data.clients.forEach(client => {
              eventList.innerHTML += `
                <div class="border rounded p-2 mb-2">
                  <strong>Name:</strong> ${client.client_name}<br>
                  <strong>Email:</strong> ${client.client_email}<br>
                  <strong>Mobile:</strong> ${client.client_no}<br>
                  <strong>Date:</strong> ${client.date}
                </div>`;
            });
          } else {
            eventList.innerHTML = "<p>No past event found.</p>";
          }
        })
        .catch(() => {
          document.getElementById('eventList').innerHTML = "<p>Error loading events.</p>";
        });
    }

    // Fetch images
    async function fetchImages() {
      try {
        const res = await fetch("/get-images-photographer");
        const data = await res.json();
        const marketplace = document.getElementById("marketplace");
        marketplace.innerHTML = "";

        data.images.forEach(image => {
          const card = document.createElement("div");
          card.className = "image-card";
          card.innerHTML = `<img src="${image.url}" alt="" onclick="expandImage('${image.url}')">`;
          marketplace.appendChild(card);
        });
      } catch (err) {
        console.error("Error fetching images:", err);
      }
    }
    fetchImages();
  </script>
</body>
</html>